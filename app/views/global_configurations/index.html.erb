<div class="container-xxl flex-grow-1 container-p-y">
  <div class="row">
    <div class="col-sm-12">
      <div class="card">
        <div class="card-header">
          <h5>Create Configuration</h5>
        </div>
        <div class="card-body">
          <%= render "form" %>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <div class="card">
      	<div class="card-header">
          <h5>Company Configurations</h5>
        </div>
        <div class="card-body">
          <div class="form-group">
            <table class="company table table-striped table-bordered confs" data-turbolinks="false">
              <thead>
              <tr>
                <td style="display: none;" class="hidden">Id</td>
                <td style="width: 15%">Key</td>
                <td style="width: 15%">Value</td>
                <td style="width: 20%">Action</td>
              </tr>
              </thead>
              <tbody>
              <% GlobalConfiguration.all.each do |confs| %>
                <tr>
                  <td style="display: none;" class="hidden"><%= confs.id %></td>
                  <td>
                    <%= confs.config_key %></td>
                  <td>
                    <label id="config_value_label_<%= confs.id %>"> <%= confs.config_value %> </label>
                    <div id="div_config_value_name_<%= confs.id %>" style="display: none;">
                      <input type="text" value="<%= confs.config_value %>" style="width:70px;" id="config_value_name_<%= confs.id %>" , name="kitqty" required>&nbsp;&nbsp;
                      <span class="fa fa-check-circle fa-lg" title="Save config value" onclick="javascript:save_config_value(<%=confs.id %>);"></span> &nbsp;&nbsp;
                      <span class="fa fa-times-circle fa-lg" title="Cancel" onclick="javascript:hide_config_value(<%=confs.id %>);" id="close_for_<%= confs.id %>"></span>
                    </div>
                  </td>
                  <td>
                    <button class="btn btn-primary btn-md edit-config-val-btn"
                            data-config-id="<%= confs.id %>">Edit the config value
                    </button>
                  </td>
                </tr>
              <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
        
<script>
  $('.confs').DataTable({
      "order": [[0, "desc"]],
      "columnDefs": [
          { "targets": [0], "searchable": false }
      ]
  });
  $('body').delegate('.edit-config-val-btn', 'click', function () {
        var content_id = $(this).data('config-id');
      $("#config_value_label_" + content_id).hide();
      $("#div_config_value_name_" + content_id).show();
  });

  function hide_config_value(id) {
      document.getElementById("config_value_label_" + id).style.display = 'block';
      document.getElementById("div_config_value_name_" + id).style.display = 'none';
  }

  function save_config_value(id) {
      var config_value_id = id;
      var config_value = $("#config_value_name_" + config_value_id).val();
      if (config_value != '') {
          $("#value_blank_id").hide();
          $.ajax({
              type: 'Post',
              data: {config_value_id: config_value_id, config_value: config_value},
              url: 'global_configurations/update_config_value',
              dataType: 'script',
              beforeSend: function(xhr) {
                  xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))
              }
          });
      } else {
          $("#close_for_" + config_value_id).hide();
          $("#value_blank_id").show();
      }
  }
  $('.config-form').validate({
      rules: {
          'global_configuration[config_key]': {
              required: true
          },
          'global_configuration[config_value]': {
              required: true
          }
      },
      messages: {
          'global_configuration[config_key]': {
              required: 'Please enter key'
          },
          'global_configuration[config_value]': {
              required: 'Please enter value',
          }
      }
  });
</script>
